<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.4">
<meta name="author" content="Álvaro Sánchez-Mariscal">
<title>Creating applications with Grails, Angular JS and Spring Security</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
body{margin:0}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
body{-webkit-font-smoothing:antialiased}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
body{tab-size:4}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Creating applications with Grails, Angular JS and Spring Security</h1>
<div class="details">
<span id="author" class="author">Álvaro Sánchez-Mariscal</span><br>
<span id="email" class="email"><a href="https://github.com/alvarosanchez"><span class="icon"><i class="fa fa-github"></i></span> @alvarosanchez</a></span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_getting_started">Getting started</a></li>
<li><a href="#_creating_a_grails_rest_api_50_minutes">1. Creating a Grails REST API (50 minutes)</a>
<ul class="sectlevel2">
<li><a href="#_understanding_profiles_5_minutes">1.1. Understanding profiles (5 minutes)</a></li>
<li><a href="#_creating_a_project_using_the_code_rest_api_code_profile_15_minutes">1.2. Creating a project using the <code>rest-api</code> profile (15 minutes)</a></li>
<li><a href="#_writing_a_custom_restful_controller_15_minutes">1.3. Writing a custom RESTful controller (15 minutes)</a></li>
<li><a href="#_customising_the_json_response_with_json_views_15_minutes">1.4. Customising the JSON response with JSON views (15 minutes)</a></li>
</ul>
</li>
<li><a href="#_creating_an_angularjs_front_end_50_minutes">2. Creating an AngularJS front-end (50 minutes)</a>
<ul class="sectlevel2">
<li><a href="#_the_code_angular_code_profile_10_minutes">2.1. The <code>angular</code> profile (10 minutes).</a></li>
<li><a href="#_writing_the_angularjs_code_40_minutes">2.2. Writing the AngularJS code (40 minutes)</a></li>
</ul>
</li>
<li><a href="#_adding_security_with_spring_security_rest_50_minutes">3. Adding security with Spring Security REST (50 minutes)</a>
<ul class="sectlevel2">
<li><a href="#_introduction_to_spring_security_rest_10_minutes">3.1. Introduction to Spring Security REST (10 minutes)</a></li>
<li><a href="#_securing_the_rest_api_20_minutes">3.2. Securing the REST API (20 minutes)</a></li>
<li><a href="#_integrating_angularjs_with_spring_security_rest_20_minutes">3.3. Integrating AngularJS with Spring Security REST (20 minutes)</a></li>
</ul>
</li>
<li><a href="#_acknowledgements">4. Acknowledgements</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<a href="https://github.com/alvarosanchez/grails-angularjs-springsecurity-workshop"><img style="position: fixed; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/365986a132ccd6a44c23a9169022c0b5c890c387/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f7265645f6161303030302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png"></a>
</div>
</div>
<div class="sect1">
<h2 id="_getting_started">Getting started</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To complete this workshop, you should have installed locally:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>JDK 7 or 8.</p>
</li>
<li>
<p>Git.</p>
</li>
<li>
<p>Gradle 2.9+.</p>
</li>
<li>
<p>Grails 3.2.6.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Also, although not mandatory, it&#8217;s highly recommended to use <a href="https://www.jetbrains.com/idea/">IntelliJ IDEA</a>, arguably
the best IDE for Groovy and Grails development. You can just use the Community Edition if you want to.</p>
</div>
<div class="paragraph">
<p>To get started, clone the workshop repo locally:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>git clone https://github.com/alvarosanchez/grails-angularjs-springsecurity-workshop.git</pre>
</div>
</div>
<div class="paragraph">
<p>The workshop is organised through a set of exercises that are described below, each of one on its own directory. Each
exercise is self-explanatory. To highlight actions you actually need to perform, an icon is used: <span class="icon"><i class="fa fa-hand-o-right"></i></span></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_creating_a_grails_rest_api_50_minutes">1. Creating a Grails REST API (50 minutes)</h2>
<div class="sectionbody">
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Change to the <code>ex01</code> folder to start working on this exercise. The final solution is provided to you in the
<code>ex01/solution</code> folder.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The first exercise in this workshop is to create a Grails application that will contain a REST API. The application
will be a todo app.</p>
</div>
<div class="sect2">
<h3 id="_understanding_profiles_5_minutes">1.1. Understanding profiles (5 minutes)</h3>
<div class="paragraph">
<p>Historically, the <code>create-app</code> and <code>create-plugin</code> Grails commands have always created Grails applications and plugins
with the same structure and files. However, Grails 3 introduced profiles, that bring more options at creation time to
start with different types of applications and plugins.</p>
</div>
<div class="paragraph">
<p>A profile defines:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The project&#8217;s <code>build.gradle</code>: dependencies, plugins installed, etc.</p>
</li>
<li>
<p>Additional commands for the CLI, such as <code>create-domain-class</code> or <code>run-app</code>.</p>
</li>
<li>
<p>Skeleton: the initial set of files and directories of the application that will be created.</p>
</li>
<li>
<p>Features: configuration subsets to bring specific behaviour. For instance, the <code>json-views</code> feature brings some
dependencies to the <code>build.gradle</code> file, defines some commands, etc.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> To find out what profiles are available, use the <code>list-profiles</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ grails list-profiles
| Available Profiles
--------------------
* angular - A profile for creating applications using AngularJS
* rest-api - Profile for REST API applications
* base - The base profile extended by other profiles
* plugin - Profile for plugins designed to work across all profiles
* web - Profile for Web applications
* web-plugin - Profile for Plugins designed for Web applications</pre>
</div>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> For more information on a particular profile use the <code>profile-info</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ grails profile-info rest-api
Profile: rest-api
--------------------
Profile for REST API applications

Provided Commands:
--------------------
* create-controller - Creates a controller
* create-domain-resource - Creates a domain class that represents a resource
* create-functional-test - Creates an functional test
* create-integration-test - Creates an integration test
* create-interceptor - Creates an interceptor
* create-restful-controller - Creates a REST controller
...</pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<code>list-profiles</code> and <code>profile-info</code> will only work outside of a Grails application folder.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_creating_a_project_using_the_code_rest_api_code_profile_15_minutes">1.2. Creating a project using the <code>rest-api</code> profile (15 minutes)</h3>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> Although we will use the <code>angular</code> profile in future exercises, for the purpose of this one we will start with the
<code>rest-api</code> profile. We will also pick the <code>hibernate</code> and <code>json-views</code> features:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ grails create-app -profile rest-api -features hibernate5,json-views todo
| Application created at /tmp/todo</pre>
</div>
</div>
<div class="paragraph">
<p>The next step is to create a domain class. In this case, not only we want a domain class, but also a REST controller
on top of it.</p>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> There are several ways to create a RESTful controller. The easiest way it&#8217;s to create a domain resource:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ grails create-domain-resource todo
| Created grails-app/domain/todo/Todo.groovy
| Created src/test/groovy/todo/TodoSpec.groovy</pre>
</div>
</div>
<div class="paragraph">
<p>This will create a domain class like this:</p>
</div>
<div class="listingblock">
<div class="title">Todo.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> todo

<span class="keyword">import</span> <span class="include">grails.rest.*</span>

<span class="annotation">@Resource</span>(readOnly = <span class="predefined-constant">false</span>, formats = [<span class="string"><span class="delimiter">'</span><span class="content">json</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">xml</span><span class="delimiter">'</span></span>])
<span class="type">class</span> <span class="class">Todo</span> {

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice the <code>@Resource</code> annotation: it&#8217;s an AST transformation that will generate at compile time a REST controller for
the domain it&#8217;s annotated to. The generated controller will have the usual CRUD methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create: <code>save()</code>.</p>
</li>
<li>
<p>Read: <code>index()</code> for all elements, and <code>show()</code> for a single one.</p>
</li>
<li>
<p>Update: <code>update()</code>.</p>
</li>
<li>
<p>Delete: <code>delete()</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In addition to that, if we define the annotation parameter <code>uri</code>, those operations will also be mapped to the
corresponding HTTP methods: <code>POST</code> for <code>create()</code>, <code>DELETE</code> for <code>delete()</code>, etc.</p>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> Add the following fields to the domain class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="predefined-type">String</span> description
<span class="type">boolean</span> done</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is how the domain class should finally look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> todo

<span class="keyword">import</span> <span class="include">grails.rest.*</span>

<span class="annotation">@Resource</span>(uri = <span class="string"><span class="delimiter">'</span><span class="content">/todos</span><span class="delimiter">'</span></span>, readOnly = <span class="predefined-constant">false</span>, formats = [<span class="string"><span class="delimiter">'</span><span class="content">json</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">xml</span><span class="delimiter">'</span></span>])
<span class="type">class</span> <span class="class">Todo</span> {
    <span class="predefined-type">String</span> description
    <span class="type">boolean</span> done
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> Before continuing, add some initial data in <code>grails-app/init/BootStrap.groovy</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">todo.Todo</span>

<span class="type">class</span> <span class="class">BootStrap</span> {

    <span class="keyword">def</span> init = { servletContext -&gt;
        <span class="integer">5</span>.times { <span class="keyword">new</span> Todo(<span class="key">description</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Todo </span><span class="inline"><span class="inline-delimiter">${</span><span class="local-variable">it</span>+<span class="integer">1</span><span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>).save() }
    }
    <span class="keyword">def</span> destroy = {
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> Next, run the application with <code>grails run-app</code>. Once it&#8217;s running, you should be able to test some endpoints using <code>curl</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>List existing todos: <code>curl -i 0:8080/todos</code></p>
</li>
<li>
<p>Create a new todo: <code>curl -i -H "Content-Type: application/json" --data '{"description":"created from curl"}' 0:8080/todos</code></p>
</li>
<li>
<p>Modify the created todo: <code>curl -i -H "Content-Type: application/json" --data '{"description":"modified from curl"}' -X PUT 0:8080/todos/6</code></p>
</li>
<li>
<p>Display the modified todo: <code>curl -i 0:8080/todos/6</code></p>
</li>
<li>
<p>And delete it: <code>curl -i -X DELETE 0:8080/todos/6</code></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_writing_a_custom_restful_controller_15_minutes">1.3. Writing a custom RESTful controller (15 minutes)</h3>
<div class="paragraph">
<p>While a domain resource may be enough for the most simplest cases, usually you will need additional actions in your
controller. So let&#8217;s get rid of the <code>@Resource</code> annotation and write our own controller.</p>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> Create a blank RESTful controller by running:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ grails create-restful-controller todo.Todo
| Created grails-app/controllers/todo/TodoController.groovy</pre>
</div>
</div>
<div class="paragraph">
<p>This will create a controller that <code>extends RestfulController</code>. <code>grails.rest.RestfulController</code> is the base class that
provides the CRUD methods like <code>index()</code>, <code>save()</code>, etc.</p>
</div>
<div class="paragraph">
<p>Note that those methods may be overriden if you need to. <code>RestfulController</code> also provides some other <code>protected</code> methods
that can as well be overriden to further customise its behaviour. Check
<a href="http://docs.grails.org/3.1.6/api/grails/rest/Resource.html">its documentation</a> for more information.</p>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> Now, define a mapping for this controller in <code>grails-app/controllers/UrlMappings.groovy</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="string"><span class="delimiter">&quot;</span><span class="content">/todos</span><span class="delimiter">&quot;</span></span>(<span class="key">resources</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">todo</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> Run the application now, and test the CRUD operations. You should see the exact same behavior as with <code>@Resource</code>.</p>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> Now, let&#8217;s add a custom action that lists only the uncompleted todos:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> <span class="function">pending</span>() {
    respond Todo.findAllByDone(<span class="predefined-constant">false</span>), <span class="key">view</span>: <span class="string"><span class="delimiter">'</span><span class="content">index</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> And also a URL mapping for such action:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="string"><span class="delimiter">&quot;</span><span class="content">/pendingTodos</span><span class="delimiter">&quot;</span></span>(<span class="key">controller</span>: <span class="string"><span class="delimiter">'</span><span class="content">todo</span><span class="delimiter">'</span></span>, <span class="key">action</span>: <span class="string"><span class="delimiter">'</span><span class="content">pending</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> If you run the application now, you should be able to test this new endpoint:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ curl -i 0:8080/pendingTodos</pre>
</div>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> You can flag one todo as completed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>curl -i -H "Content-Type: application/json" --data '{"done": true}' -X PUT 0:8080/todos/3</pre>
</div>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> Then, verify that the <code>/pendingTodos</code> endpoint works as expected.</p>
</div>
</div>
<div class="sect2">
<h3 id="_customising_the_json_response_with_json_views_15_minutes">1.4. Customising the JSON response with JSON views (15 minutes)</h3>
<div class="paragraph">
<p>The <a href="https://github.com/grails/grails-views">Grails Views</a> project provides additional view technologies to the Grails
framework, including JSON and Markup views. It was introduced in Grails 3.0.</p>
</div>
<div class="paragraph">
<p>JSON views are written in Groovy, end with the file extension <code>gson</code> and reside in the <code>grails-app/views</code> directory.
They provide a DSL for producing output in the JSON format. A hello world example can be seen below:</p>
</div>
<div class="listingblock">
<div class="title"><code>grails-app/views/hello.gson</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">json.message {
    hello <span class="string"><span class="delimiter">&quot;</span><span class="content">world</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above JSON view results in the output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">{<span class="key"><span class="delimiter">&quot;</span><span class="content">message</span><span class="delimiter">&quot;</span></span>:{ <span class="key"><span class="delimiter">&quot;</span><span class="content">hello</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">world</span><span class="delimiter">&quot;</span></span>}}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>json</code> variable is an instance of
<a href="http://docs.groovy-lang.org/latest/html/api/groovy/json/StreamingJsonBuilder.html">StreamingJsonBuilder</a>. See the
<a href="http://docs.groovy-lang.org/latest/html/documentation/core-domain-specific-languages.html#_streamingjsonbuilder">documentation</a>
in the Groovy user guide for more information on <code>StreamingJsonBuilder</code>.</p>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> To get started with the JSON views for the <code>Todo</code> domain class, run the <code>generate-views</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ grails generate-views todo.Todo
| Rendered template index.gson to destination grails-app/views/todo/index.gson
| Rendered template show.gson to destination grails-app/views/todo/show.gson
| Rendered template _domain.gson to destination grails-app/views/todo/_todo.gson
| Scaffolding completed for grails-app/domain/todo/Todo.groovy</pre>
</div>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> Let&#8217;s change <code>grails-app/views/todo/_todo.gson</code> to put some <a href="https://tools.ietf.org/html/draft-kelly-json-hal-08">HAL</a> information in the response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">todo.Todo</span>

model {
        Todo todo
}

json {
        _links {
                self {
                        href <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>g.link(<span class="key">resource</span>: <span class="string"><span class="delimiter">'</span><span class="content">todo</span><span class="delimiter">'</span></span>, <span class="key">absolute</span>: <span class="predefined-constant">true</span>)<span class="inline-delimiter">}</span></span><span class="content">/</span><span class="inline"><span class="inline-delimiter">${</span>todo.id<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
                }
        }
  id todo.id
        description todo.description
        done todo.done
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> If we run the application and hit the <code>/todos</code> endpoint, we can see the new information:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">[{
        <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="integer">1</span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">description</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Todo 1</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">done</span><span class="delimiter">&quot;</span></span>: <span class="predefined-constant">false</span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">_links</span><span class="delimiter">&quot;</span></span>: {
                <span class="key"><span class="delimiter">&quot;</span><span class="content">self</span><span class="delimiter">&quot;</span></span>: {
                        <span class="key"><span class="delimiter">&quot;</span><span class="content">href</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080/todos/1</span><span class="delimiter">&quot;</span></span>
                }
        }
}, {
  ...
}]</code></pre>
</div>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> Fortunately, Grails' JSON views comes with support for HAL automatically:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">todo.Todo</span>

model {
        Todo todo
}

json {
        hal.links(todo)
        id todo.id
        description todo.description
        done todo.done
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> Hit the <code>/todos</code> endpoint again to see the difference.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_creating_an_angularjs_front_end_50_minutes">2. Creating an AngularJS front-end (50 minutes)</h2>
<div class="sectionbody">
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Change to the <code>ex02</code> folder to start working on this exercise. The final solution is provided to you in the
<code>ex02/solution</code> folder.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_the_code_angular_code_profile_10_minutes">2.1. The <code>angular</code> profile (10 minutes).</h3>
<div class="paragraph">
<p>The <code>angular</code> profile was introduced in Grails 3.1. It provides a more focused set of dependencies and commands to work
with Angular JS. The <code>angular</code> profile inherits from the <code>rest-api</code> profile and therefore has all of the commands and
properties that the REST profile has.</p>
</div>
<div class="paragraph">
<p>The <code>angular</code> profile creates applications that provides the following features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Default set of commands for creating Angular artefacts.</p>
</li>
<li>
<p>Gradle plugin to manage client side dependencies.</p>
</li>
<li>
<p>Gradle plugin to execute client side unit tests.</p>
</li>
<li>
<p>Asset Pipeline plugins to ease development.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>By default the Angular profile includes GSP support in order to render the index page. This is necessary because the
profile is designed around <a href="http://www.asset-pipeline.com/"><code>asset-pipeline</code></a>.</p>
</div>
<div class="paragraph">
<p>The new commands that the profile brings are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>create-ng-component</code>.</p>
</li>
<li>
<p><code>create-ng-controller</code>.</p>
</li>
<li>
<p><code>create-ng-directive</code>.</p>
</li>
<li>
<p><code>create-ng-domain</code>.</p>
</li>
<li>
<p><code>create-ng-module</code>.</p>
</li>
<li>
<p><code>create-ng-service</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All the files generated are placed by default under <code>grails-app/assets/javascripts</code>. For example, the command
<code>grails create-ng-controller foo</code> will create the file
<code>grails-app/assets/javascripts/${default package name}/controllers/fooController.js</code>.</p>
</div>
<div class="paragraph">
<p>For every artefact created, the profile commands will also create a skeleton unit test file under <code>src/test/javascripts</code></p>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> To get started with the Angular profile create an application with by specifying angular as the name
of the profile:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ grails create-app --profile angular -features hibernate,json-views todo
| Application created at /tmp/todo</pre>
</div>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> Now, copy the following elements from the previous project to the created one:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>grails-app/controllers/todo/TodoController.groovy</code>.</p>
</li>
<li>
<p><code>grails-app/domain/todo/Todo.groovy</code>.</p>
</li>
<li>
<p><code>grails-app/init/BootStrap.groovy</code>.</p>
</li>
<li>
<p><code>grails-app/views/todo/*</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> After that, re-apply the URL mappings that we previously had:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="string"><span class="delimiter">&quot;</span><span class="content">/todos</span><span class="delimiter">&quot;</span></span>(<span class="key">resources</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">todo</span><span class="delimiter">&quot;</span></span>)
<span class="string"><span class="delimiter">&quot;</span><span class="content">/pendingTodos</span><span class="delimiter">&quot;</span></span>(<span class="key">controller</span>: <span class="string"><span class="delimiter">'</span><span class="content">todo</span><span class="delimiter">'</span></span>, <span class="key">action</span>: <span class="string"><span class="delimiter">'</span><span class="content">pending</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> Then, run the application to ensure that the <code>/todo</code> and <code>/pendingTodos</code> are working as expected.
Also, if you load the root URL, you should see something like:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/localhost.png" alt="localhost">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_writing_the_angularjs_code_40_minutes">2.2. Writing the AngularJS code (40 minutes)</h3>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Ultimately it&#8217;s not a goal of this workshop that you become a master in Angular JS development. A basic Angular JS
knowledge is required to understand the steps performed through the exercise.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The entry point for the application, as specified by the <code>/</code> URL mapping, is <code>grails-app/views/index.gsp</code>. That file
contains by default information about the application. Simply ignore it.</p>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> Find a <code>&lt;section&gt;</code> tag, and leave its body empty:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><span class="tag">&lt;div</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">content</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">role</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">main</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;section</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">row colset-2-its</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

        <span class="comment">&lt;!-- Our code will be here --&gt;</span>

    <span class="tag">&lt;/section&gt;</span>
<span class="tag">&lt;/div&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> Also, remove everything under <code>grails-app/assets/javascripts/*</code>, as we want to write our own code.</p>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> Let&#8217;s create a domain by running the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ grails create-ng-domain todo
| Rendered template NgModuleSpec.js to destination src/test/javascripts/todo/todo/todo.todoSpec.js
| Rendered template NgModule.js to destination grails-app/assets/javascripts/todo/todo/todo.todo.js
| Rendered template NgDomainSpec.js to destination src/test/javascripts/todo/domain/TodoSpec.js
| Rendered template NgDomain.js to destination grails-app/assets/javascripts/todo/domain/Todo.js</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>todo/domain/Todo.js</code> file will export a module that will allow us to write code such as <code>Todo.list()</code>,
<code>todo.save()</code>, etc. A-la-Grails! On such methods, Angular JS will transparently excute an HTTP request to the backend,
by taking into account the REST mappings. For example, <code>Todo.list()</code> will make an HTTP GET request, <code>todo.delete()</code>
will do a DELETE, etc.</p>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> There&#8217;s just a change we need to do on it: as our backend is at <code>/todos</code> and not <code>/todo</code>, find the
string <code>"todo/:id"</code> and replace it by <code>"todos/:id"</code>.</p>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> The root module, generated at <code>grails-app/assets/javascripts/todo/todo.todo.js</code>, is named a bit
repetitive, so rename it to <code>app.js</code>, and leave it with the following content:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="comment">//= wrapped</span>
<span class="comment">//= require /angular/angular</span>
<span class="comment">//= require /angular/angular-resource</span>
<span class="comment">//= require_self</span>
<span class="comment">//= require_tree services</span>
<span class="comment">//= require_tree controllers</span>
<span class="comment">//= require_tree directives</span>
<span class="comment">//= require_tree domain</span>
<span class="comment">//= require_tree templates</span>

angular.module(<span class="string"><span class="delimiter">&quot;</span><span class="content">todo</span><span class="delimiter">&quot;</span></span>, [<span class="string"><span class="delimiter">'</span><span class="content">ngResource</span><span class="delimiter">'</span></span>]);</code></pre>
</div>
</div>
<div class="paragraph">
<p>That will be our main file to be loaded in <code>index.gsp</code>. As you can see, it contains asset-pipeline instructions to
include other dependencies such as Angular itself, as well as our application code.</p>
</div>
<div class="paragraph">
<p>The dependencies like <code>angular</code> and <code>angular-resource</code> are fetched by the <code>client-dependencies</code> Gradle plugin. You will
find a <code>clientDependencies { &#8230;&#8203; }</code> block in <code>build.gradle</code>. Those dependencies are gently handled by asset-pipeline, which takes
action during the build process, to bundle and minimise them into our <code>app.js</code> file. In development mode, however,
minimisation and bundling is not performed.</p>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> Now, let&#8217;s create a controller by running the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ grails create-ng-controller todo
| Warning Destination file src/test/javascripts/todo/todo/todo.todoSpec.js already exists, skipping...
| Rendered template NgModule.js to destination grails-app/assets/javascripts/todo/todo/todo.todo.js
| Rendered template NgControllerSpec.js to destination src/test/javascripts/todo/controllers/todoControllerSpec.js
| Rendered template NgController.js to destination grails-app/assets/javascripts/todo/controllers/todoController.js</pre>
</div>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> The controller code should look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="comment">//= wrapped</span>

angular
    .module(<span class="string"><span class="delimiter">&quot;</span><span class="content">todo</span><span class="delimiter">&quot;</span></span>)
    .controller(<span class="string"><span class="delimiter">&quot;</span><span class="content">TodoController</span><span class="delimiter">&quot;</span></span>, TodoController);

<span class="keyword">function</span> <span class="function">TodoController</span>(Todo) {
    <span class="keyword">var</span> vm = <span class="local-variable">this</span>;

    vm.todos = Todo.list();

    vm.newTodo = <span class="keyword">new</span> Todo();

    vm.<span class="function">save</span> = <span class="keyword">function</span>() {
        vm.newTodo.<span class="predefined">$save</span>({}, <span class="keyword">function</span>() {
            vm.todos.push(angular.copy(vm.newTodo));
            vm.newTodo = <span class="keyword">new</span> Todo();
        });
    };

    vm.<span class="keyword">delete</span> = <span class="keyword">function</span>(todo) {
        todo.<span class="predefined">$delete</span>({}, <span class="keyword">function</span>() {
            <span class="keyword">var</span> idx = vm.todos.indexOf(todo);
            vm.todos.splice(idx, <span class="integer">1</span>);
        });
    };

    vm.<span class="function">update</span> = <span class="keyword">function</span>(todo) {
        todo.<span class="predefined">$update</span>();
    };
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, let&#8217;s write the view code.</p>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> First of all, make sure our entry point <code>app.js</code> is loaded in <code>index.gsp</code>. Find
the <code>&lt;asset:javascript&gt;</code> tag right before the closing <code>&lt;/body&gt;</code>, and change it to point to our file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><span class="tag">&lt;asset:javascript</span> <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/todo/app.js</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> Then, find the <code>&lt;body&gt;</code> tag and change it so it refers to our controller instead of the
default one that we deleted. It should look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><span class="tag">&lt;body</span> <span class="attribute-name">ng-app</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">todo</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ng-controller</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">TodoController as vm</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> Finally, inside the <code>&lt;section&gt;</code> tag, where we left a placeholder comment, write the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><span class="tag">&lt;div</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">form</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ng-model</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">vm.newTodo.description</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;button</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">button</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ng-click</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">vm.save()</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>add<span class="tag">&lt;/button&gt;</span>
<span class="tag">&lt;/div&gt;</span>

<span class="tag">&lt;div</span> <span class="attribute-name">ng-include</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">'/todo/list.html'</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/div&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> Now, create the following file:</p>
</div>
<div class="listingblock">
<div class="title"><code>grails-app/assets/javascripts/todo/templates/list.tpl.html</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><span class="tag">&lt;table&gt;</span>
    <span class="tag">&lt;tbody&gt;</span>
        <span class="tag">&lt;tr</span> <span class="attribute-name">ng-repeat</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">t in vm.todos</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;td&gt;</span>
                {{t.description}}
            <span class="tag">&lt;/td&gt;</span>
            <span class="tag">&lt;td&gt;</span>
                <span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">checkbox</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ng-model</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">t.done</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ng-click</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">vm.update(t)</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
            <span class="tag">&lt;/td&gt;</span>
            <span class="tag">&lt;td&gt;</span>
                <span class="tag">&lt;button</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">button</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ng-click</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">vm.delete(t)</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>Delete<span class="tag">&lt;/button&gt;</span>
            <span class="tag">&lt;/td&gt;</span>
        <span class="tag">&lt;/tr&gt;</span>
    <span class="tag">&lt;/tbody&gt;</span>
<span class="tag">&lt;/table&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And you are done! Go back to your browser and load <a href="http://localhost:8080" class="bare">http://localhost:8080</a>:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/todo.png" alt="todo">
</div>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> With your browser&#8217;s developer console open, try to create new todos, mark them as complete or
delete them, and you will see how Angular JS issues HTTP request to the backend we created in the first exercise.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_adding_security_with_spring_security_rest_50_minutes">3. Adding security with Spring Security REST (50 minutes)</h2>
<div class="sectionbody">
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
For this exercise, you can just continue working in the same project as the previous exercise. The final solution
is provided to you in the <code>ex03/solution</code> folder.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_introduction_to_spring_security_rest_10_minutes">3.1. Introduction to Spring Security REST (10 minutes)</h3>
<div class="paragraph">
<p><a href="http://alvarosanchez.github.io/grails-spring-security-rest/">Spring Security REST</a> is a Grails plugin that allows you to
use Spring Security for a stateless, token-based, RESTful authentication.</p>
</div>
<div class="paragraph">
<p>The typical flow could be the following:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="http://alvarosanchez.github.io/grails-spring-security-rest/latest/docs/images/rest.png" alt="rest">
</div>
<div class="title">Figure 1. Sequence diagram overview of the plugin behavior</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The client application requests and endpoint that requires authentication, so the server responds with a 401 response.</p>
</li>
<li>
<p>The client redirects the user to the login form.</p>
</li>
<li>
<p>The user enter credentials, and the client sends a request to the authentication endpoint. The server validates credentials, and if valid, generates, stores and sends back a token to the client.</p>
</li>
<li>
<p>The client then stores the token internally. It will be sent on every API method request.</p>
</li>
<li>
<p>The client sends again a request to the protected resource, passing the token as an HTTP header.</p>
</li>
<li>
<p>The server validates the token, and if valid, executes the actual operation requested.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>As per the <a href="http://en.wikipedia.org/wiki/Representational_state_transfer">REST definition</a>, the client is transferring its
state on every request so the server is truly stateless.</p>
</div>
<div class="paragraph">
<p>The plugin helps you to wire your existing Spring Security authentication mechanism, provides you
with ready-to-use token generation strategies and comes prepackaged with JWT, Memcached, GORM, Redis
and Grails Cache support for token storage.</p>
</div>
<div class="paragraph">
<p>In this exercise we will use JWT. JSON Web Token (JWT) is an <a href="http://tools.ietf.org/html/draft-ietf-oauth-json-web-token">IETF standard</a> (in progress)
which defines a secure way to encapsulate arbitrary data that can be sent over unsecure URL&#8217;s.</p>
</div>
<div class="paragraph">
<p>Generally speaking, JWT&#8217;s can be useful in the following use cases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When generating "one click" action emails, like "delete this comment" or "add this to favorites". Instead of giving
the users URL&#8217;s like <code>/comment/delete/123</code>, you can give them something like <code>/comment/delete/&lt;JWT_TOKEN&gt;</code>, where the
<code>JWT_TOKEN</code> contains encapsulated information about the user and the comment, in a safe way, so authentication is not required.</p>
</li>
<li>
<p>To achieve single sign-on, by sharing a JWT across applications.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the context of authentication and authorization, JWT will help you implement a stateless implementation, as the
principal information is stored directly in the JWT.</p>
</div>
<div class="paragraph">
<p>This is how a JWT looks like:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="http://alvarosanchez.github.io/grails-spring-security-rest/latest/docs/images/jwt.png" alt="jwt">
</div>
</div>
<div class="sect4">
<h5 id="_header">Header</h5>
<div class="paragraph">
<p>A base64-encoded JSON like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">alg</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">HS256</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">typ</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">JWT</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_claims">Claims</h5>
<div class="paragraph">
<p>A base64-encoded JSON like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">exp</span><span class="delimiter">&quot;</span></span>: <span class="integer">1422990129</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">sub</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">jimi</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">roles</span><span class="delimiter">&quot;</span></span>: [
        <span class="string"><span class="delimiter">&quot;</span><span class="content">ROLE_ADMIN</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">ROLE_USER</span><span class="delimiter">&quot;</span></span>
    ],
    <span class="key"><span class="delimiter">&quot;</span><span class="content">iat</span><span class="delimiter">&quot;</span></span>: <span class="integer">1422986529</span>
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_signature">Signature</h5>
<div class="paragraph">
<p>Depends on the algorithm specified on the header, it can be a digital signature of the base64-encoded header and claims,
or an encryption of them using RSA.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_securing_the_rest_api_20_minutes">3.2. Securing the REST API (20 minutes)</h3>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> To install the plugin, add this to your <code>dependencies { &#8230;&#8203; }</code> block in <code>build.gradle</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">compile <span class="string"><span class="delimiter">&quot;</span><span class="content">org.grails.plugins:spring-security-rest:2.0.0.M2</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> Run <code>grails compile</code> to resolve dependencies and ensure everything is correct. If necessary,
refresh also the project in your IDE (ie: refresh Gradle project in Intellij IDEA). Then, we need to generate our User,
Role and UserRole domain classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ grails s2-quickstart todo User Role
| Creating User class 'User' and Role class 'Role' in package 'todo'
| Rendered template Person.groovy.template to destination grails-app/domain/todo/User.groovy
| Rendered template Authority.groovy.template to destination grails-app/domain/todo/Role.groovy
| Rendered template PersonAuthority.groovy.template to destination grails-app/domain/todo/UserRole.groovy
|
************************************************************
* Created security-related domain classes. Your            *
* grails-app/conf/application.groovy has been updated with *
* the class names of the configured domain classes;        *
* please verify that the values are correct.               *
************************************************************</pre>
</div>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> The above command will create the file <code>grails-app/conf/application.groovy</code>. In order to secure our
API, we need to replace the chain with pattern <code>/**</code> with this one:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">[<span class="key">pattern</span>: <span class="string"><span class="delimiter">'</span><span class="content">/api/**</span><span class="delimiter">'</span></span>,         <span class="key">filters</span>: <span class="string"><span class="delimiter">'</span><span class="content">JOINED_FILTERS,-anonymousAuthenticationFilter,-exceptionTranslationFilter,-authenticationProcessingFilter,-securityContextPersistenceFilter,-rememberMeAuthenticationFilter</span><span class="delimiter">'</span></span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> Notice that we are appling a stateless chain to the pattern <code>/api/**</code>, so we need to reflect this
change in a number of places:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In the URL mappings file.</p>
</li>
<li>
<p>In the <code>Todo.js</code> Angular domain.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> Now, add some data in <code>BootStrap.groovy</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="predefined-type">Role</span> admin = <span class="keyword">new</span> <span class="predefined-type">Role</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">ROLE_ADMIN</span><span class="delimiter">&quot;</span></span>).save()
User user = <span class="keyword">new</span> User(<span class="string"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">pass</span><span class="delimiter">&quot;</span></span>).save()
UserRole.create(user, admin, <span class="predefined-constant">true</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> Finally, let&#8217;s restrict our API to be accessed only for <code>ROLE_ADMIN</code> users:</p>
</div>
<div class="listingblock">
<div class="title"><code>TodoController.groovy</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> todo

<span class="keyword">import</span> <span class="include">grails.plugin.springsecurity.annotation.Secured</span>
<span class="keyword">import</span> <span class="include">grails.rest.RestfulController</span>

<span class="annotation">@Secured</span>([<span class="string"><span class="delimiter">'</span><span class="content">ROLE_ADMIN</span><span class="delimiter">'</span></span>])
<span class="type">class</span> <span class="class">TodoController</span> <span class="directive">extends</span> RestfulController {

...

}</code></pre>
</div>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> If you run the application now and try to access the endpoint with <code>curl</code>, you&#8217;ll receive an error:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="predefined">$</span> curl -i <span class="integer">0</span>:<span class="integer">8080</span>/api/todos
HTTP/<span class="float">1.1</span> <span class="integer">401</span> Unauthorized
Server: Apache-Coyote/<span class="float">1.1</span>
WWW-Authenticate: Bearer
Content-Type: application/json;charset=UTF-<span class="integer">8</span>
Transfer-Encoding: chunked
Date: Wed, <span class="octal">01</span> Jun <span class="integer">2016</span> <span class="octal">03</span>:<span class="integer">59</span>:<span class="integer">56</span> GMT

{<span class="key"><span class="delimiter">&quot;</span><span class="content">timestamp</span><span class="delimiter">&quot;</span></span>:<span class="integer">1464753596208</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">status</span><span class="delimiter">&quot;</span></span>:<span class="integer">401</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">error</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Unauthorized</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">message</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">No message available</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">path</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">/api/todos</span><span class="delimiter">&quot;</span></span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As we saw in the introduction, we need to obtain a token first, and then pass it to the endpoint.</p>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> To get a token, make a request to the login endpoint provided by the plugin:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="predefined">$</span> curl -i -H <span class="string"><span class="delimiter">&quot;</span><span class="content">Content-Type: application/json</span><span class="delimiter">&quot;</span></span> --data <span class="string"><span class="delimiter">'</span><span class="content">{&quot;username&quot;:&quot;user&quot;,&quot;password&quot;:&quot;pass&quot;}</span><span class="delimiter">'</span></span> <span class="integer">0</span>:<span class="integer">8080</span>/api/login
HTTP/<span class="float">1.1</span> <span class="integer">200</span> OK
Server: Apache-Coyote/<span class="float">1.1</span>
Cache-Control: no-store
Pragma: no-cache
Content-Type: application/json;charset=UTF-<span class="integer">8</span>
Content-Length: <span class="integer">2152</span>
Date: Wed, <span class="octal">01</span> Jun <span class="integer">2016</span> <span class="octal">04</span>:<span class="octal">04</span>:<span class="integer">51</span> GMT

{<span class="key"><span class="delimiter">&quot;</span><span class="content">username</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">roles</span><span class="delimiter">&quot;</span></span>:[<span class="string"><span class="delimiter">&quot;</span><span class="content">ROLE_ADMIN</span><span class="delimiter">&quot;</span></span>],<span class="key"><span class="delimiter">&quot;</span><span class="content">token_type</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Bearer</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">access_token</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">eyJhbGciOiJIUzI1NiJ9...</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">expires_in</span><span class="delimiter">&quot;</span></span>:<span class="integer">3600</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">refresh_token</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">eyJhbGciOiJIUzI1NiJ9....</span><span class="delimiter">&quot;</span></span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> Copy the <code>access_token</code> part of the response, and make a request to the original endpoint, passing
the token in a header:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="predefined">$</span> curl -i -H <span class="string"><span class="delimiter">&quot;</span><span class="content">Authorization: Bearer eyJhbGciOiJIUzI1NiJ9....</span><span class="delimiter">&quot;</span></span> <span class="integer">0</span>:<span class="integer">8080</span>/api/todos
HTTP/<span class="float">1.1</span> <span class="integer">200</span> OK
Server: Apache-Coyote/<span class="float">1.1</span>
X-Application-Context: application:development
Content-Type: application/json;charset=UTF-<span class="integer">8</span>
Transfer-Encoding: chunked
Date: Wed, <span class="octal">01</span> Jun <span class="integer">2016</span> <span class="octal">04</span>:<span class="integer">08</span>:<span class="integer">14</span> GMT

[{<span class="key"><span class="delimiter">&quot;</span><span class="content">_links</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">self</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">href</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">http://0:8080/api/todos/1</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">hreflang</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">en_US</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">application/hal+json</span><span class="delimiter">&quot;</span></span>}},<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">1</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">description</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Todo 1</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">done</span><span class="delimiter">&quot;</span></span>:<span class="predefined-constant">false</span>},{<span class="key"><span class="delimiter">&quot;</span><span class="content">_links</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">self</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">href</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">http://0:8080/api/todos/2</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">hreflang</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">en_US</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">application/hal+json</span><span class="delimiter">&quot;</span></span>}},<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">2</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">description</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Todo 2</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">done</span><span class="delimiter">&quot;</span></span>:<span class="predefined-constant">false</span>},{<span class="key"><span class="delimiter">&quot;</span><span class="content">_links</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">self</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">href</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">http://0:8080/api/todos/3</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">hreflang</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">en_US</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">application/hal+json</span><span class="delimiter">&quot;</span></span>}},<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">3</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">description</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Todo 3</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">done</span><span class="delimiter">&quot;</span></span>:<span class="predefined-constant">false</span>},{<span class="key"><span class="delimiter">&quot;</span><span class="content">_links</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">self</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">href</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">http://0:8080/api/todos/4</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">hreflang</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">en_US</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">application/hal+json</span><span class="delimiter">&quot;</span></span>}},<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">4</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">description</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Todo 4</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">done</span><span class="delimiter">&quot;</span></span>:<span class="predefined-constant">false</span>},{<span class="key"><span class="delimiter">&quot;</span><span class="content">_links</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">self</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">href</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">http://0:8080/api/todos/5</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">hreflang</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">en_US</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">application/hal+json</span><span class="delimiter">&quot;</span></span>}},<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">5</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">description</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Todo 5</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">done</span><span class="delimiter">&quot;</span></span>:<span class="predefined-constant">false</span>}]</code></pre>
</div>
</div>
<div class="paragraph">
<p>And voilà! Our API is now sucessfully secured with Spring Security REST.</p>
</div>
</div>
<div class="sect2">
<h3 id="_integrating_angularjs_with_spring_security_rest_20_minutes">3.3. Integrating AngularJS with Spring Security REST (20 minutes)</h3>
<div class="paragraph">
<p>The final step of this workshop is to introduce a login workflow in the front-end, and put the necessary Angular JS
infrastructure to make sure that the token, once obtained, is transparently sent on every request.</p>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> First of all, in <code>index.gsp</code> we need to display a login form if the user is not authenticated. Put
the following code as the body of the <code>&lt;section&gt;</code> tag:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="tag">&lt;div</span> <span class="attribute-name">ng-switch</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">vm.authenticated</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;div</span> <span class="attribute-name">ng-switch-when</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;div</span> <span class="attribute-name">ng-include</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">'/todo/list.html'</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/div&gt;</span>
    &lt;<span class="regexp"><span class="delimiter">/</span><span class="content">div&gt;
    &lt;div ng-switch-when=&quot;false&quot;&gt;
        &lt;div ng-include=&quot;'</span><span class="delimiter">/</span></span>todo/login.html<span class="string"><span class="delimiter">'</span><span class="content">&quot;&gt;&lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> Then, create such template:</p>
</div>
<div class="listingblock">
<div class="title"><code>grails-app/assets/javascripts/todo/templates/login.tpl.html</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><span class="tag">&lt;table&gt;</span>
    <span class="tag">&lt;tbody&gt;</span>
    <span class="tag">&lt;tr&gt;</span>
        <span class="tag">&lt;td&gt;</span>
            Username:
        <span class="tag">&lt;/td&gt;</span>
        <span class="tag">&lt;td&gt;</span>
            <span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">username</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ng-model</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">vm.user.username</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;/td&gt;</span>
    <span class="tag">&lt;/tr&gt;</span>
    <span class="tag">&lt;tr&gt;</span>
        <span class="tag">&lt;td&gt;</span>
            Password:
        <span class="tag">&lt;/td&gt;</span>
        <span class="tag">&lt;td&gt;</span>
            <span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ng-model</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">vm.user.password</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;/td&gt;</span>
    <span class="tag">&lt;/tr&gt;</span>
    <span class="tag">&lt;tr&gt;</span>
        <span class="tag">&lt;td</span> <span class="attribute-name">colspan</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;button</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">button</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ng-click</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">vm.login()</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>Login<span class="tag">&lt;/button&gt;</span>
        <span class="tag">&lt;/td&gt;</span>
    <span class="tag">&lt;/tr&gt;</span>
    <span class="tag">&lt;/tbody&gt;</span>
<span class="tag">&lt;/table&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> Now, we need to put the necessary logic in the controller to handle the authentication, as well as
the submission of the token once obtained:</p>
</div>
<div class="listingblock">
<div class="title"><code>grails-app/assets/javascripts/todo/controllers/todoController.js</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="comment">//= wrapped</span>

angular
    .module(<span class="string"><span class="delimiter">&quot;</span><span class="content">todo</span><span class="delimiter">&quot;</span></span>)
    .factory(<span class="string"><span class="delimiter">'</span><span class="content">authInterceptor</span><span class="delimiter">'</span></span>, <span class="keyword">function</span> (<span class="predefined">$rootScope</span>, <span class="predefined">$window</span>) {
        <span class="keyword">return</span> {
            <span class="function">request</span>: <span class="keyword">function</span> (config) {
                config.headers = config.headers || {};
                <span class="keyword">if</span> (<span class="predefined">$window</span>.sessionStorage.token) {
                    config.headers.Authorization = <span class="string"><span class="delimiter">'</span><span class="content">Bearer </span><span class="delimiter">'</span></span> + <span class="predefined">$window</span>.sessionStorage.token;
                }
                <span class="keyword">return</span> config;
            }
        };
    })
    .config(<span class="keyword">function</span> (<span class="predefined">$httpProvider</span>) {
        <span class="predefined">$httpProvider</span>.interceptors.push(<span class="string"><span class="delimiter">'</span><span class="content">authInterceptor</span><span class="delimiter">'</span></span>);
    })
    .controller(<span class="string"><span class="delimiter">&quot;</span><span class="content">TodoController</span><span class="delimiter">&quot;</span></span>, TodoController);

<span class="keyword">function</span> <span class="function">TodoController</span>(Todo, <span class="predefined">$http</span>, <span class="predefined">$window</span>) {
    <span class="keyword">var</span> vm = <span class="local-variable">this</span>;

    vm.authenticated = <span class="predefined-constant">false</span>;
    vm.user = {};

    vm.todos = [];

    vm.newTodo = <span class="keyword">new</span> Todo();

    vm.<span class="function">login</span> = <span class="keyword">function</span> () {
        <span class="predefined">$http</span>.post(<span class="string"><span class="delimiter">'</span><span class="content">/api/login</span><span class="delimiter">'</span></span>, {
            <span class="key">username</span>: vm.user.username,
            <span class="key">password</span>: vm.user.password
        }).then(<span class="keyword">function</span> (response) {
            vm.authenticated = <span class="predefined-constant">true</span>;
            <span class="predefined">$window</span>.sessionStorage.token = response.data.access_token;
            vm.todos = Todo.list();
        });
    };

    vm.<span class="function">save</span> = <span class="keyword">function</span>() {
        vm.newTodo.<span class="predefined">$save</span>({}, <span class="keyword">function</span>() {
            vm.todos.push(angular.copy(vm.newTodo));
            vm.newTodo = <span class="keyword">new</span> Todo();
        });
    };

    vm.<span class="keyword">delete</span> = <span class="keyword">function</span>(todo) {
        todo.<span class="predefined">$delete</span>({}, <span class="keyword">function</span>() {
            <span class="keyword">var</span> idx = vm.todos.indexOf(todo);
            vm.todos.splice(idx, <span class="integer">1</span>);
        });
    };

    vm.<span class="function">update</span> = <span class="keyword">function</span>(todo) {
        todo.<span class="predefined">$update</span>();
    };
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And that&#8217;s all!</p>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> You can run again the application, with your browser&#8217;s developer console opened, and you will see
how the auhentication is performed, and once logged in, you can also see how the token is sent in the header.</p>
</div>
<div class="paragraph">
<p>If you liked this workshop <a href="https://twitter.com/home?status=Check%20out%20%40alvaro_sanchez&#8217;s%20cool%20workshop%20about%20%40grailsframework%20%40angularjs%20%26%20%40springsecurity%3A%20http%3A//alvarosanchez.github.io/grails-angularjs-springsecurity-workshop%20%23grailsfw%20%40groovylang"><span class="icon"><i class="fa fa-twitter"></i></span> share it on Twitter!</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_acknowledgements">4. Acknowledgements</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/sdelamo">Sergio del Amo</a>, for his fantastic help upgrading
this workshop to Grails 3.2.6.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2017-02-26 20:06:56 +01:00
</div>
</div>
</body>
</html>